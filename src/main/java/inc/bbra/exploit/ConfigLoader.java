package inc.bbra.exploit;

import inc.bbra.exploit.utils.ChatUtil;
import inc.bbra.exploit.utils.other.FriendsManager;
import net.minecraftforge.client.event.RenderGameOverlayEvent;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;

import java.io.IOException;

public class ConfigLoader {
    boolean isLoaded = false;
    private short ticksPassed = 0;
    @SubscribeEvent
    public void onRender(RenderGameOverlayEvent.Post e){
        if(!isLoaded){
            try {
                FriendsManager.ConfigManager.loadFromCfg();
                ChatUtil.sendMessage("The config was successfully loaded.");
            } catch (IOException ex) {
                ChatUtil.sendMessage("Failed to load the config.");
                throw new RuntimeException(ex);
            } try {
                FriendsManager.ConfigManager.loadFriendList();
                ChatUtil.sendMessage("The friendlist was successfully loaded");
            } catch (IOException ex) {
                ex.printStackTrace();
                ChatUtil.sendMessage("Failed to load the friendlist");
            } try {
                FriendsManager.ConfigManager.loadSettings();
                ChatUtil.sendMessage("Settings were restored!");
            } catch (IOException ex){
                ex.printStackTrace();
                ChatUtil.sendMessage("Failed to load settings");
            } try {
                FriendsManager.ConfigManager.loadGuiState();
            } catch (IOException ex) {
                ex.printStackTrace();
            } try {
                FriendsManager.ConfigManager.loadBinds();
            } catch (IOException ex) {
                ex.printStackTrace();
            }
            isLoaded = true;
        }
    }
    @SubscribeEvent
    public void onTick(TickEvent.PlayerTickEvent e) throws IOException {
        this.ticksPassed++;
        if(this.ticksPassed > 40 && isLoaded){
            this.ticksPassed = 0;
            FriendsManager.ConfigManager.saveSettings();
            FriendsManager.ConfigManager.saveGuiState();
            FriendsManager.ConfigManager.saveBinds();
        }
    }
}
