package inc.bbra.exploit.Module.MISC;


import inc.bbra.exploit.BBraExploit;
import inc.bbra.exploit.Module.Module;
import inc.bbra.exploit.utils.other.FriendsManager;
import net.minecraftforge.fml.common.network.FMLNetworkEvent;
import org.lwjgl.input.Keyboard;

import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;
import inc.bbra.newclickgui.Setting;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;


public class Spammer extends Module {


	private static String text = null;
	private boolean ending = true;
	private static int endingNum = 0;
	private boolean doStop = true;

	private ArrayList<String> spamLines = new ArrayList();


	public Spammer() {
		super("Spammer", Keyboard.KEY_NONE, Category.MISC);
		BBraExploit.instance.sManager.rSetting(new Setting("Ticks", this, 10, 1, 60, true));
		BBraExploit.instance.sManager.rSetting(new Setting("Ending", this, true));
		BBraExploit.instance.sManager.rSetting(new Setting("Off on leave", this, true));
	}
	private static int ticks = 0;
	private static int line = 0;

	@Override
	public void onEnable() throws IOException {
		loadLines();
		super.onEnable();
	}
	
	@SubscribeEvent
    public void onPlayerTickEvent(TickEvent.PlayerTickEvent e){
		this.ending = BBraExploit.instance.sManager.getSettingByName(this.name, "Ending").getValBoolean();
		this.doStop = BBraExploit.instance.sManager.getSettingByName(this.name, "Off on leave").getValBoolean();
		text = this.spamLines.get(line % spamLines.size());

		if (ticks % (int)BBraExploit.instance.sManager.getSettingByName(this.name, "Ticks").getValDouble() * 20 == 0 && this.ending){
			this.endingNum++;
			mc.player.sendChatMessage(text + endingNum);
			line++;
		} else if (ticks % (int)BBraExploit.instance.sManager.getSettingByName(this.name, "Ticks").getValDouble() * 20 == 0){
			mc.player.sendChatMessage(text);
			line++;
		}
		ticks++;
	}
	@SubscribeEvent
	public void onLeave(FMLNetworkEvent.ClientDisconnectionFromServerEvent event) throws IOException {
		if(this.doStop){
			this.setToggled(false);
		}
	}

	public void loadLines() throws IOException{
		this.spamLines.clear();
		BufferedReader br = new BufferedReader(new FileReader("spammer.txt"));
		String fline;
		while ((fline = br.readLine()) != null) {
			try {
				this.spamLines.add(fline);
			} catch (Exception e){e.printStackTrace();}
		}
		br.close();
	}
}
