package inc.bbra.exploit.clickgui.modules;

import inc.bbra.exploit.BBraExploit;
import inc.bbra.exploit.Client;
import inc.bbra.exploit.Module.Module;
import inc.bbra.exploit.clickgui.GUI;
import inc.bbra.exploit.clickgui.UtilGui;
import inc.bbra.exploit.utils.ChatUtil;
import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.Gui;
import net.minecraftforge.fml.client.config.GuiUtils;
import org.lwjgl.input.Keyboard;

import java.awt.*;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

public class ModCategory {
    Minecraft mc = Minecraft.getMinecraft( );
    public int w = 120;
    public int h = 15;
    public int x, y;
    public int dragY, dragX;
    public boolean dragging;
    public int marginY = 0;

    public boolean deployed = true;
    public boolean isDraggingRightNow = false;
    public Module.Category category;
    CopyOnWriteArrayList<Module> modules = Client.modules;
    private ArrayList<Module> modulesInCategory = new ArrayList<Module>( );
    public ArrayList<ModButton> buttons = new ArrayList<ModButton>( );
    public ArrayList<ModButton> buttonsBackup = new ArrayList<ModButton>( );


    public ModCategory(int x, int y, Module.Category category) {
        this.category = category;
        this.x = x;
        this.y = y;
        for (Module i : modules) {
            if (i.getCategory( ) == category) {
                modulesInCategory.add(i);
            }
        }
        marginY += 1;
        for (Module i : modulesInCategory) {
            marginY += 1;
            ModButton button = new ModButton(this.x + 5, this.y + this.h + this.marginY, i);
            button.margin = marginY;
            GUI.INSTANCE.getModButtons( ).add(button);
            this.buttons.add(button);
            this.buttonsBackup.add(button);
            marginY += 20 + 1;
        }
        marginY = 0;
    }

    public void refreshChildrenMargins(ArrayList<ModButton> m) {
        this.buttons.clear();
        this.buttons.addAll(m);
        int margin = 1;
        for (ModButton i : buttons) {
            margin += 1;
            i.margin = margin;
            i.updateMyPos(x + 5, y + h + i.margin);
            margin += 20 + 1;
        }
    }

    public void setMarginDeployedButt(){
        int margin = 1;
        for (ModButton i : buttons) {
            margin += 1;
            i.margin = margin;
            i.updateMyPos(x + 5, y + h + i.margin);
            margin += 20 + 1;
            if (i.m.isDeployed){
                margin += i.settingsHeight;
            }
        }
    }

    public void onClick(int mouseX, int mouseY, int button) throws IOException {
        try {
            if (UtilGui.isClicked(mouseX, mouseY, button, x, y, w, h, UtilGui.MOUSEBUTTON.RIGHT)) {
                for (ModButton i : buttons) {
                    i.parentCategoryDeployed = !i.parentCategoryDeployed;
                }
            } else if (UtilGui.isClicked(mouseX, mouseY, button, x, y, w, h, UtilGui.MOUSEBUTTON.LEFT)) {
                dragX = mouseX - x;
                dragY = mouseY - y;
                dragging = true;
            }
        } catch (Exception e) {

        }
    }

    public void mouseReleased(int mouseX, int mouseY, int state) {
        try {
            dragging = false;
        } catch (Exception e) {

        }
    }

    public void draw(int mouseX, int mouseY, float partialTicks) {
        try {
            if (dragging) {
//                if ()
                x = mouseX - dragX;
                y = mouseY - dragY;
                for (ModButton b : buttons) {
                    b.updateMyPos(x + 5, y + h + b.margin);
                }
            }
            setMarginDeployedButt();
            Gui.drawRect(x, y, x + w, y + h, new Color(166, 30, 20, 200).hashCode( ));
            //////// Borders
            Gui.drawRect(x - 1, y, x, y + h, Color.BLACK.hashCode( ));//left
            Gui.drawRect(x + w, y, x + w + 1, y + h, Color.BLACK.hashCode( ));//right
            Gui.drawRect(x, y + 1, x + w, y, Color.BLACK.hashCode( ));//top
            Gui.drawRect(x, y + h, x + w, y + h + 1, Color.BLACK.hashCode( ));//bottom
            /////Text
            mc.fontRenderer.drawString(category.name( ), x + 15, y + 4, Color.WHITE.hashCode( ));
            //////////////// ChildrenButtons
            for (ModButton i : buttons){
                i.draw();
            }
        } catch (Exception e) {

        }
    }
}
