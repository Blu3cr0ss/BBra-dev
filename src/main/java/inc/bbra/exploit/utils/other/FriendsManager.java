package inc.bbra.exploit.utils.other;

import inc.bbra.exploit.BBraExploit;
import inc.bbra.exploit.Client;
import inc.bbra.exploit.Module.Module;
import inc.bbra.exploit.utils.ChatUtil;
import inc.bbra.newclickgui.Setting;

import java.io.*;
import java.util.ArrayList;

public class FriendsManager {
    public static boolean doCheck = false;
    private static final ArrayList<String> friends = new ArrayList<>();

    public static void addFriend(String target) throws IOException {
        friends.add(target);
        ConfigManager.saveFriendList();
    }

    public static void removeFriend(String target) throws IOException{
        for (int i = 0;i < friends.size();i++){
            if (friends.get(i) == target){
                friends.remove(i);
            }
        }
        ConfigManager.saveFriendList();
    }

    public static void toggleFriend(String target) throws IOException{
        if (isFriend(target)){
            removeFriend(target);
        } else {
            addFriend(target);
        }
    }
    public static void clearFriends() {
        friends.clear();
    }

    public static boolean isFriend(String target) {
        if(doCheck) {
            for (String friend : friends) {
                if (target == friend) {
                    return true;
                }
            }
        }
        return false;
    }

    public static int getNumFriends(){
        return friends.size();
    }

    public static class ConfigManager {

        public static ArrayList<String> ignoredModules = new ArrayList<>();

        public ConfigManager() throws FileNotFoundException {
        }
        public static void Init() {
            ignoredModules.add("Unload");
            ignoredModules.add("SelfDestruct");
            ignoredModules.add("FakePlayer");
            ignoredModules.add("KeyPearl");
            ignoredModules.add("Music");
            ignoredModules.add("HighJump");
            ignoredModules.add("KillAura");
            ignoredModules.add("CAura");
            try {
                File cfgFile = new File("cfg.txt");
                File setFile = new File("sets.txt");
                File friendFile = new File("friends.txt");

                if (!cfgFile.exists())
                    cfgFile.createNewFile();
                if (!setFile.exists())
                    setFile.createNewFile();
                if (!friendFile.exists())
                    friendFile.exists();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        public static void saveActive() throws IOException {
            File cfgFile = new File("cfg.txt");
            if (cfgFile.exists()) {
                cfgFile.delete();
                cfgFile.createNewFile();
            }
            PrintWriter pw = new PrintWriter(cfgFile);
            for (Module m : Client.modules) {
                if (m.isEnabled() && !ignoredModules.contains(m.getName())) {
                    pw.println(m.getName());
                }
            }
            pw.close();
        }

        public static void loadFromCfg() throws IOException {
            BufferedReader br = new BufferedReader(new FileReader("cfg.txt"));
            String line;
            while ((line = br.readLine()) != null) {
                try {
                    if (!ignoredModules.contains(line))
                        Client.getHackByName(line).activate();
                } catch (Exception e){e.printStackTrace();}
            }
            br.close();
        }

        public static void saveFriendList() throws IOException{
            File friendFile = new File("friends.txt");
            if (friendFile.exists()) {
                friendFile.delete();
                friendFile.createNewFile();
            }
            PrintWriter pw = new PrintWriter(friendFile);
            for (String name : FriendsManager.friends){
                pw.println(name);
            }
            pw.close();
        }

        public static void loadFriendList() throws IOException{
            BufferedReader br = new BufferedReader(new FileReader("friends.txt"));
            String fline;
            while ((fline = br.readLine()) != null) {
                try {
                    FriendsManager.addFriend(fline);
                } catch (Exception e){e.printStackTrace();}
            }
            br.close();
        }

        public static void saveSettings() throws IOException{
            File settingFile = new File("sets.txt");
            if (settingFile.exists()) {
                settingFile.delete();
                settingFile.createNewFile();
            }
            PrintWriter pw = new PrintWriter(settingFile);
            for (Setting setting : BBraExploit.instance.sManager.getSettings()){
                if (setting.isSlider()) {
                    pw.println(setting.getParentMod().getName());
                    pw.println(setting.getName());
                    pw.println(setting.getValDouble());
                }
                else if (setting.isCheck()) {
                    pw.println(setting.getParentMod().getName());
                    pw.println(setting.getName());
                    pw.println(setting.getValBoolean());
                }
                else if (setting.isMode()) {
                    pw.println(setting.getParentMod().getName());
                    pw.println(setting.getName());
                    pw.println(setting.getValString());
                }
            }
            pw.close();
        }
        private static short currentTask = -1;
        private static Module currentModule = null;
        private static Setting currentSetting = null;
        public static void loadSettings() throws IOException{
            BufferedReader br = new BufferedReader(new FileReader("sets.txt"));
            String sline;

            while ((sline = br.readLine()) != null) {
                currentTask++;
                if (currentTask == 0) {
                    currentModule = Client.getHackByName(sline);
                    if (currentModule == null) { ChatUtil.sendMessage("Module " + sline + " wasn't found"); break;}
                }
                if (currentTask == 1) {
                    currentSetting = BBraExploit.instance.sManager.getSettingByName(currentModule.getName(), sline);
                    if (currentSetting == null) { ChatUtil.sendMessage("Setting " + sline + " wasn't found"); break;}
                }
                if (currentTask == 2) {
                    if (currentSetting.isCheck())
                        currentSetting.setValBoolean(Boolean.parseBoolean(sline));
                    if (currentSetting.isMode())
                        currentSetting.setValString(sline);
                    if (currentSetting.isSlider())
                        currentSetting.setValDouble(Double.parseDouble(sline));
                    currentTask = -1;
                    currentModule = null;
                    currentSetting = null;
                }
            }
            br.close();
        }
    }
}